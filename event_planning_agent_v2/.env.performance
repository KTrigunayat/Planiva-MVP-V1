# Performance-optimized environment configuration for Event Planning Agent v2
# This configuration is tuned for optimal performance in production environments

# ============================================================================
# ENVIRONMENT SETTINGS
# ============================================================================
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO

# ============================================================================
# DATABASE PERFORMANCE SETTINGS
# ============================================================================

# Optimized connection pool settings
DB_POOL_SIZE=25
DB_MAX_OVERFLOW=50
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_POOL_PRE_PING=true

# Query optimization settings
DB_ECHO=false
DB_ECHO_POOL=false

# Performance tuning parameters (in milliseconds)
DB_STATEMENT_TIMEOUT=30000
DB_LOCK_TIMEOUT=10000
DB_IDLE_TIMEOUT=60000

# Connection health monitoring
DB_MAX_CONNECTION_ERRORS=5
DB_CONNECTION_RETRY_DELAY=5

# Query caching
DB_ENABLE_QUERY_CACHE=true
DB_QUERY_CACHE_SIZE=2000
DB_QUERY_CACHE_TTL=300

# ============================================================================
# LLM PERFORMANCE SETTINGS
# ============================================================================

# Model configuration
GEMMA_MODEL=gemma:2b
TINYLLAMA_MODEL=tinyllama

# Optimized timeouts and retries
MODEL_TIMEOUT=180
MODEL_RETRIES=3
MODEL_WARMUP_ENABLED=true
MODEL_KEEP_ALIVE=300

# Response caching
LLM_ENABLE_RESPONSE_CACHE=true
LLM_RESPONSE_CACHE_SIZE=3000
LLM_RESPONSE_CACHE_TTL=1800

# Batch processing optimization
LLM_ENABLE_BATCH_PROCESSING=true
LLM_BATCH_SIZE=5
LLM_BATCH_TIMEOUT=60

# Connection optimization
LLM_MAX_CONNECTIONS=15
LLM_CONNECTION_TIMEOUT=30
LLM_READ_TIMEOUT=120

# GPU optimization (if available)
LLM_USE_GPU=true
LLM_GPU_MEMORY_FRACTION=0.8

# ============================================================================
# WORKFLOW PERFORMANCE SETTINGS
# ============================================================================

# CrewAI optimization
CREW_VERBOSE=false
MAX_ITERATIONS=8

# LangGraph optimization (preserve k=3 beam search)
BEAM_WIDTH=3
MAX_WORKFLOW_ITERATIONS=15

# Enhanced state management
STATE_CHECKPOINT_INTERVAL=3
MAX_BEAM_HISTORY_SIZE=50
ENABLE_STATE_COMPRESSION=true

# Optimized timeouts
AGENT_TIMEOUT=240
WORKFLOW_TIMEOUT=1200

# Parallel execution
ENABLE_PARALLEL_AGENTS=true
MAX_PARALLEL_AGENTS=3

# Early termination optimization
ENABLE_EARLY_TERMINATION=true
EARLY_TERMINATION_THRESHOLD=0.9
MIN_ITERATIONS_BEFORE_TERMINATION=3

# Convergence detection
ENABLE_CONVERGENCE_DETECTION=true
CONVERGENCE_THRESHOLD=0.05
CONVERGENCE_WINDOW=3

# Memory optimization
ENABLE_MEMORY_OPTIMIZATION=true
MAX_MEMORY_USAGE_MB=2048

# ============================================================================
# API PERFORMANCE SETTINGS
# ============================================================================

# Server configuration
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=false

# CORS optimization
CORS_ORIGINS=*
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_HEADERS=*

# ============================================================================
# SECURITY SETTINGS (Performance-Optimized)
# ============================================================================

# Authentication
AUTH_ENABLED=true
JWT_ALGORITHM=HS256
TOKEN_EXPIRY_HOURS=24

# Rate limiting (balanced for performance)
RATE_LIMITING_ENABLED=true
RATE_LIMIT_PER_MINUTE=120
RATE_LIMIT_PER_HOUR=2000
RATE_LIMIT_BURST=20

# Security headers
ENABLE_SECURITY_HEADERS=true
ALLOWED_HOSTS=*

# ============================================================================
# MCP SERVER SETTINGS
# ============================================================================

# MCP configuration
MCP_SERVERS_CONFIG=config/mcp_config.json
MCP_AUTO_APPROVE_TOOLS=enhanced_vendor_search,vendor_compatibility_check,fitness_score_calculation,budget_optimization
MCP_CONNECTION_TIMEOUT=30
MCP_REQUEST_TIMEOUT=60

# ============================================================================
# OBSERVABILITY SETTINGS
# ============================================================================

# Logging optimization
LOG_LEVEL=INFO
ENABLE_TRACING=true
ENABLE_METRICS=true
LOG_FORMAT=json
LOG_ROTATION=1 day
LOG_RETENTION=30 days

# ============================================================================
# CACHING SETTINGS
# ============================================================================

# Application-level caching
ENABLE_CACHING=true
CACHE_SIZE=5000
CACHE_TTL=600

# Redis configuration (if using Redis for caching)
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=20
REDIS_SOCKET_KEEPALIVE=true
REDIS_SOCKET_KEEPALIVE_OPTIONS=1,3,5

# ============================================================================
# PERFORMANCE MONITORING
# ============================================================================

# Metrics collection
COLLECT_PERFORMANCE_METRICS=true
METRICS_COLLECTION_INTERVAL=60
ENABLE_PROFILING=false

# Health check optimization
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=5

# ============================================================================
# RESOURCE LIMITS
# ============================================================================

# Memory limits
MAX_MEMORY_USAGE=4096
MEMORY_WARNING_THRESHOLD=3072

# CPU limits
MAX_CPU_USAGE=80
CPU_WARNING_THRESHOLD=70

# Disk usage limits
MAX_DISK_USAGE=85
DISK_WARNING_THRESHOLD=75

# ============================================================================
# BACKUP AND MAINTENANCE
# ============================================================================

# Automated maintenance
AUTO_VACUUM_ENABLED=true
AUTO_ANALYZE_ENABLED=true
MAINTENANCE_WINDOW=02:00-04:00

# Backup settings
BACKUP_ENABLED=true
BACKUP_INTERVAL=24h
BACKUP_RETENTION=7d

# ============================================================================
# DEVELOPMENT OVERRIDES (Comment out in production)
# ============================================================================

# Uncomment these for development/testing environments
# DEBUG=true
# LOG_LEVEL=DEBUG
# DB_ECHO=true
# CREW_VERBOSE=true
# API_RELOAD=true
# ENABLE_PROFILING=true

# ============================================================================
# DOCKER OPTIMIZATION SETTINGS
# ============================================================================

# Container resource limits
DOCKER_MEMORY_LIMIT=4g
DOCKER_CPU_LIMIT=2.0
DOCKER_CPU_RESERVATION=1.0
DOCKER_MEMORY_RESERVATION=2g

# Health check settings
DOCKER_HEALTH_CHECK_INTERVAL=30s
DOCKER_HEALTH_CHECK_TIMEOUT=10s
DOCKER_HEALTH_CHECK_RETRIES=3
DOCKER_HEALTH_CHECK_START_PERIOD=60s

# ============================================================================
# POSTGRESQL OPTIMIZATION SETTINGS
# ============================================================================

# These should be set in PostgreSQL configuration or docker-compose
# Included here for reference

# Connection settings
# max_connections=200
# shared_buffers=512MB
# effective_cache_size=2GB
# maintenance_work_mem=128MB

# Performance settings
# checkpoint_completion_target=0.9
# wal_buffers=32MB
# default_statistics_target=100
# random_page_cost=1.1
# effective_io_concurrency=200

# Memory settings
# work_mem=8MB
# min_wal_size=1GB
# max_wal_size=4GB

# ============================================================================
# OLLAMA OPTIMIZATION SETTINGS
# ============================================================================

# Ollama server optimization
OLLAMA_NUM_PARALLEL=4
OLLAMA_MAX_LOADED_MODELS=3
OLLAMA_KEEP_ALIVE=5m
OLLAMA_HOST=0.0.0.0:11434

# GPU settings (if available)
OLLAMA_GPU_LAYERS=35
OLLAMA_NUMA=false

# ============================================================================
# NGINX OPTIMIZATION (if using reverse proxy)
# ============================================================================

# Worker processes and connections
# worker_processes=auto
# worker_connections=1024
# keepalive_timeout=65
# keepalive_requests=100

# Compression
# gzip=on
# gzip_vary=on
# gzip_min_length=1000
# gzip_types=text/plain application/json application/javascript text/css

# ============================================================================
# MONITORING AND ALERTING THRESHOLDS
# ============================================================================

# Response time thresholds (milliseconds)
RESPONSE_TIME_WARNING=2000
RESPONSE_TIME_CRITICAL=5000

# Error rate thresholds (percentage)
ERROR_RATE_WARNING=5
ERROR_RATE_CRITICAL=10

# Resource usage thresholds (percentage)
CPU_USAGE_WARNING=70
CPU_USAGE_CRITICAL=85
MEMORY_USAGE_WARNING=75
MEMORY_USAGE_CRITICAL=90

# Workflow performance thresholds
WORKFLOW_TIME_WARNING=120000
WORKFLOW_TIME_CRITICAL=300000
BEAM_SEARCH_ITERATIONS_WARNING=12
BEAM_SEARCH_ITERATIONS_CRITICAL=18